<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>Pool Scoring</title>
    <style>
        /* Base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #1a1a1a;
            color: white;
            min-height: 100vh;
            overscroll-behavior: none;
        }

        /* Screen container */
        .screen-container {
            position: relative;
            width: 100%;
            min-height: 100vh;
        }

        /* Individual screens */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            min-height: 100vh;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            transform: translateX(100%);
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .screen.active {
            display: block;
            opacity: 1;
            transform: translateX(0);
            position: relative;
        }

        .screen.slide-out {
            transform: translateX(-100%);
        }

        .screen.slide-in {
            transform: translateX(0);
        }

        /* Screen content */
        .screen-content {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            padding: 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .screen-title {
            font-size: 24px;
            margin-bottom: 20px;
        }

        /* Game List Screen specific styles */
        .game-list {
            width: 100%;
            flex: 1;
            overflow-y: auto;
        }

        .game-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .data-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-button {
            flex: 1;
            min-width: 100px;
            padding: 20px;
            background: #333;
            color: white;
            border: none;
            border-radius: 0;
            font-size: 20px;
            cursor: pointer;
            touch-action: manipulation;
        }

        .filter-button.active {
            background: #4CAF50;
        }

        .filter-button[onclick="filterGames('active')"] {
            background: #1e4620;
        }

        .filter-button[onclick="filterGames('active')"].active {
            background: #4CAF50;
        }

        .filter-button[onclick="filterGames('completed')"] {
            background: #3a3a3a;
        }

        .filter-button[onclick="filterGames('completed')"].active {
            background: #4CAF50;
        }

        .data-button {
            flex: 1;
            min-width: 100px;
            padding: 20px;
            background: #333;
            color: white;
            border: none;
            border-radius: 0;
            font-size: 20px;
            cursor: pointer;
            touch-action: manipulation;
        }

        .data-button.export {
            background: #1e4620;
        }

        .data-button.import {
            background: #3a3a3a;
        }

        .file-input {
            display: none;
        }

        .game-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem;
            margin-bottom: 0.75rem;
            background: #fff;
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.1s ease, background-color 0.2s ease;
        }

        .game-item.active {
            background: #1e4620;
        }

        .game-item.completed {
            background: #3a3a3a;
        }

        .game-item:active {
            transform: scale(0.98);
        }

        .game-info {
            flex: 1;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .game-type {
            font-weight: bold;
            font-size: 1.5rem;
            min-width: 8rem;
        }

        .player-names {
            color: #fff;
            font-size: 1.5rem;
            min-width: 20rem;
        }

        .game-scores {
            font-size: 2rem;
            font-weight: bold;
            min-width: 6rem;
            text-align: center;
        }

        .delete-button {
            width: 3rem;
            height: 3rem;
            border: none;
            background: #ff4444;
            color: white;
            border-radius: 50%;
            font-size: 1.5rem;
            line-height: 1;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 1rem;
            transition: background-color 0.2s;
            position: relative;
        }

        .delete-button::before {
            content: 'üóëÔ∏è';
            font-size: 1.5rem;
        }

        .delete-button:hover {
            background: #cc0000;
        }

        .delete-button:active {
            transform: scale(0.95);
        }

        .game-item.completed {
            opacity: 0.7;
        }

        .empty-state {
            text-align: center;
            padding: 2rem;
            color: #666;
            font-size: 1.5rem;
        }

        .game-players {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .game-details {
            color: #ccc;
            font-size: 18px;
        }

        .game-actions {
            display: flex;
            gap: 10px;
        }

        .action-button {
            padding: 20px;
            background: #333;
            color: white;
            border: none;
            border-radius: 0;
            font-size: 20px;
            cursor: pointer;
            touch-action: manipulation;
        }

        /* Game Detail Screen specific styles */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            width: 100%;
        }

        .game-title {
            font-size: 24px;
            color: #ccc;
        }

        .score-display {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 20px;
            flex: 1;
        }

        .player-score {
            flex: 1;
            text-align: center;
            padding: 20px;
            margin: 0 5px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .player-score:first-child {
            background: #4CAF50; /* Bright green */
        }

        .player-score:nth-child(2) {
            background: #1f21f2; /* Bright blue */
        }

        .player-score:last-child {
            background: #f44336; /* Bright red */
        }

        .player-score.franky {
            background: #ffffff !important; /* Special background for Fr√§nky */
        }

        .player-score.franky .player-name,
        .player-score.franky .score {
            color: #f12f12 !important; /* Special red text for Fr√§nky */
        }

        .player-name {
            font-size: 24px;
            margin-bottom: 20px;
        }

        .score {
            font-size: 15rem;
            font-weight: bold;
            margin: 20px 0;
        }

        .score-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .score-button {
            flex: 1;
            padding: 30px;
            background: #333;
            color: white;
            border: none;
            border-radius: 0;
            font-size: 36px;
            cursor: pointer;
            touch-action: manipulation;
        }

        .score-button:active {
            transform: scale(0.95);
        }

        .game-controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            width: 100%;
        }

        .control-button {
            flex: 1;
            padding: 30px;
            background: #333;
            color: white;
            border: none;
            border-radius: 0;
            font-size: 24px;
            cursor: pointer;
            touch-action: manipulation;
        }

        .control-button.warning {
            background: #f44336;
        }

        /* Navigation buttons */
        .nav-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0 40px 0;  /* Increased bottom margin */
        }

        .nav-button {
            padding: 30px;
            background: #333;
            color: white;
            border: none;
            border-radius: 0;
            font-size: 24px;
            cursor: pointer;
            touch-action: manipulation;
        }

        /* New Game Screen specific styles */
        .player-inputs {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
            flex: 1;
        }

        .player-input {
            margin-bottom: 20px;
        }

        .player-input label {
            display: block;
            margin-bottom: 10px;
            color: #ccc;
            font-size: 24px;
        }

        .name-input-container {
            display: flex;
            gap: 10px;
        }

        .name-select {
            flex: 1;
            padding: 30px;
            border: 2px solid #333;
            background: #2a2a2a;
            color: white;
            font-size: 24px;
            min-height: 44px;
        }

        .name-input {
            flex: 2;
            padding: 30px;
            border: 2px solid #333;
            background: #2a2a2a;
            color: white;
            font-size: 24px;
            min-height: 44px;
        }

        .name-select:focus, .name-input:focus {
            outline: none;
            border-color: #666;
        }

        .game-settings {
            margin-top: 20px;
            width: 100%;
        }

        .setting-group {
            margin-bottom: 20px;
        }

        .setting-group select {
            width: 100%;
            padding: 30px;
            border: 2px solid #333;
            background: #2a2a2a;
            color: white;
            font-size: 24px;
            min-height: 44px;
            padding: 12px;
        }

        .setting-group input {
            width: 100%;
            padding: 30px;
            border: 2px solid #333;
            background: #2a2a2a;
            color: white;
            font-size: 24px;
        }

        .setting-group input:focus {
            outline: none;
            border-color: #666;
        }

        .start-game-button {
            margin-top: 20px;
            padding: 30px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 0;
            font-size: 24px;
            cursor: pointer;
            touch-action: manipulation;
        }

        /* Disabled states */
        .player-score.completed {
            opacity: 0.7;
        }

        .score-button:disabled,
        .control-button:disabled,
        .action-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Loading overlay */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .loading-indicator {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
        }

        .modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-button {
            font-size: 24px;
            cursor: pointer;
            color: #888;
        }

        .close-button:hover {
            color: white;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .modal-button {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        .modal-button.cancel {
            background-color: #444;
            color: white;
        }

        .modal-button.confirm {
            background-color: #e74c3c;
            color: white;
        }

        .modal-button:hover {
            opacity: 0.9;
        }

        /* Touch feedback animations */
        .button, .control-button, .score-button, .delete-button, .filter-button, .nav-button {
            transition: transform 0.1s ease, background-color 0.2s ease;
        }

        .button:active, .control-button:active, .score-button:active, .delete-button:active, .filter-button:active, .nav-button:active {
            transform: scale(0.95);
        }

        /* Ensure minimum touch target size */
        .button, .control-button, .score-button, .delete-button, .filter-button, .nav-button {
            min-height: 44px;
            min-width: 44px;
            padding: 12px 24px;
        }

        /* Touch feedback for game items */
        .game-item {
            transition: transform 0.1s ease, background-color 0.2s ease;
        }

        .game-item:active {
            transform: scale(0.98);
        }

        /* Input fields touch optimization */
        input {
            min-height: 44px;
            padding: 12px;
            font-size: 1.2rem;
        }

        /* Select fields touch optimization */
        select {
            min-height: 44px;
            padding: 12px;
            font-size: 1.2rem;
        }

        /* Responsive styles */
        @media screen and (max-width: 480px) {
            .game-detail {
                padding: 15px;
            }

            .scores-container {
                flex-direction: column;
                gap: 15px;
            }

            .player-score {
                padding: 15px;
            }

            .player-name {
                font-size: 20px;
            }

            .score {
                font-size: 36px;
            }

            .score-buttons {
                flex-wrap: wrap;
            }

            .score-button {
                padding: 8px 16px;
                font-size: 16px;
            }

            .game-actions {
                flex-direction: column;
                gap: 10px;
            }

            .action-button {
                padding: 8px;
                font-size: 16px;
            }

            .new-game-form {
                padding: 15px;
            }

            .form-group input,
            .form-group select {
                padding: 8px;
                font-size: 14px;
            }

            .form-button {
                padding: 8px 16px;
                font-size: 14px;
            }

            .filter-buttons {
                flex-wrap: wrap;
            }

            .filter-button {
                padding: 6px 12px;
                font-size: 14px;
            }
        }

        @media screen and (min-width: 481px) and (max-width: 768px) {
            .game-detail {
                padding: 20px;
            }

            .scores-container {
                gap: 15px;
            }

            .player-score {
                padding: 15px;
            }

            .player-name {
                font-size: 22px;
            }

            .score {
                font-size: 42px;
            }

            .score-button {
                padding: 8px 16px;
                font-size: 16px;
            }

            .new-game-form {
                padding: 20px;
            }

            .form-group input,
            .form-group select {
                padding: 8px;
                font-size: 16px;
            }

            .form-button {
                padding: 8px 16px;
                font-size: 16px;
            }

            .filter-button {
                padding: 6px 12px;
                font-size: 14px;
            }
        }

        /* Game detail styles */
        .game-detail {
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding: 20px;
            background-color: #2a2a2a;
            border-radius: 10px;
            margin-top: 20px;
            min-height: 0; /* Allow content to shrink */
        }

        .scores-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            min-height: 0; /* Allow content to shrink */
        }

        .player-score {
            flex: 1;
            text-align: center;
            padding: 20px;
            background-color: #333;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            min-height: 0; /* Allow content to shrink */
        }

        .player-name {
            font-size: 24px;
            margin-bottom: 10px;
            color: #fff;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .score {
            font-size: 50vh;
            font-weight: bold;
            margin: 10px 0;
            line-height: 1;
        }

        .score-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: auto; /* Push buttons to bottom */
        }

        .score-button {
            background-color: #333;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.2s;
            min-width: 80px; /* Ensure buttons have minimum width */
        }

        /* Responsive styles */
        @media screen and (max-width: 480px) {
            .game-detail {
                padding: 15px;
                margin-top: 10px;
            }

            .scores-container {
                flex-direction: column;
                gap: 15px;
            }

            .player-score {
                padding: 15px;
                min-height: 200px; /* Ensure minimum height for score display */
            }

            .player-name {
                font-size: 20px;
            }

            .score {
                font-size: 25vh;
            }

            .score-buttons {
                flex-wrap: wrap;
                justify-content: center;
            }

            .score-button {
                padding: 8px 16px;
                font-size: 16px;
                min-width: 70px;
            }
        }

        @media screen and (min-width: 481px) and (max-width: 768px) {
            .game-detail {
                padding: 20px;
            }

            .scores-container {
                gap: 15px;
            }

            .player-score {
                padding: 15px;
                min-height: 180px; /* Ensure minimum height for score display */
            }

            .player-name {
                font-size: 22px;
            }

            .score {
                font-size: 25vh;
            }

            .score-button {
                padding: 8px 16px;
                font-size: 16px;
                min-width: 70px;
            }
        }

        /* Fullscreen toggle button */
        .fullscreen-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background-color: rgba(52, 152, 219, 0.9);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 9999;
            transition: background-color 0.2s, transform 0.2s;
        }

        .fullscreen-toggle:hover {
            background-color: rgba(52, 152, 219, 1);
            transform: scale(1.1);
        }

        .fullscreen-toggle:active {
            transform: scale(0.95);
        }

        .fullscreen-toggle svg {
            width: 24px;
            height: 24px;
        }

        @media screen and (max-width: 480px) {
            .fullscreen-toggle {
                bottom: 15px;
                right: 15px;
                width: 40px;
                height: 40px;
            }
        }

        .optional-player {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #eee;
        }

        .optional-player label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .optional-player input[type="checkbox"] {
            margin: 0;
        }

        .scores-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
            padding: 1rem;
        }

        .player-score {
            flex: 1;
            min-width: 200px;
            max-width: 400px;
        }

        @media (max-width: 768px) {
            .player-score {
                min-width: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="screen-container">
        <!-- New Game Screen -->
        <div class="screen" id="new-game-screen">
            <div class="screen-content">
                <h1 class="screen-title">Neues Spiel</h1>
                <div class="player-inputs">
                    <div class="player-input">
                        <label for="player1">Spieler 1</label>
                        <div class="name-input-container">
                            <select id="player1-select" class="name-select" onchange="updatePlayerInput('player1')">
                                <option value="">Vorherige Spieler...</option>
                            </select>
                            <input type="text" id="player1" placeholder="Name Spieler 1" class="name-input">
                        </div>
                    </div>
                    <div class="player-input">
                        <label for="player2">Spieler 2</label>
                        <div class="name-input-container">
                            <select id="player2-select" class="name-select" onchange="updatePlayerInput('player2')">
                                <option value="">Vorherige Spieler...</option>
                            </select>
                            <input type="text" id="player2" placeholder="Name Spieler 2" class="name-input">
                        </div>
                    </div>
                    <div class="player-input">
                        <label for="player3">Spieler 3 (optional)</label>
                        <div class="name-input-container">
                            <select id="player3-select" class="name-select" onchange="updatePlayerInput('player3')">
                                <option value="">Vorherige Spieler...</option>
                            </select>
                            <input type="text" id="player3" placeholder="Name Spieler 3" class="name-input">
                        </div>
                    </div>
                </div>
                <div class="game-settings">
                    <div class="setting-group">
                        <label for="game-type">Spieltyp</label>
                        <select id="game-type">
                            <option value="8-Ball">8-Ball</option>
                            <option value="9-Ball">9-Ball</option>
                            <option value="10-Ball">10-Ball</option>
                            <option value="14/1">14/1 endlos</option>
                        </select>
                    </div>
                    <div class="setting-group">
                        <label for="race-to">Race to X (optional)</label>
                        <input type="number" id="race-to" placeholder="0" min="0" max="99">
                    </div>
                </div>
                <div class="nav-buttons">
                    <button class="nav-button" onclick="createNewGame()">Spiel starten</button>
                    <button class="nav-button" onclick="showScreen('game-list-screen')">Abbrechen</button>
                </div>
            </div>
        </div>

        <!-- Game List Screen -->
        <div class="screen active" id="game-list-screen">
            <div class="screen-content">
                <h1 class="screen-title">Spiele</h1>
                <div class="game-list">
                    <div class="nav-buttons">
                        <button class="nav-button" onclick="showScreen('new-game-screen')">Neues Spiel</button>
                    </div>
                    <div class="game-filters">
                        <button class="filter-button active" onclick="filterGames('all')">Alle</button>
                        <button class="filter-button" onclick="filterGames('active')">Aktiv</button>
                        <button class="filter-button" onclick="filterGames('completed')">Abgeschlossen</button>
                    </div>
                    <div id="games-container">
                        <!-- Games will be added dynamically -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Detail Screen -->
        <div class="screen" id="game-detail-screen">
            <div class="screen-content">
                <div class="game-header">
                    <div class="game-title" id="game-title">8-Ball | Race to 5</div>
                    <button class="nav-button" onclick="showScreen('game-list-screen')">Zur√ºck zur Liste</button>
                </div>
                <div class="scores-container">
                    <div class="player-score">
                        <div class="player-name" id="player1-name">Spieler 1</div>
                        <div class="score" id="score1" onclick="updateScore(currentGameId, 1, 1)">0</div>
                        <div class="score-buttons">
                            <button class="score-button" onclick="updateScore(currentGameId, 1, -1)">-</button>
                            <button class="score-button" onclick="updateScore(currentGameId, 1, 1)">+</button>
                        </div>
                    </div>
                    <div class="player-score">
                        <div class="player-name" id="player2-name">Spieler 2</div>
                        <div class="score" id="score2">0</div>
                        <div class="score-buttons">
                            <button class="score-button" onclick="updateScore(currentGameId, 2, -1)">-</button>
                            <button class="score-button" onclick="updateScore(currentGameId, 2, 1)">+</button>
                        </div>
                    </div>
                    <div class="player-score" id="player3-score" style="display: none;">
                        <div class="player-name" id="player3-name">Spieler 3</div>
                        <div class="score" id="score3">0</div>
                        <div class="score-buttons">
                            <button class="score-button" onclick="updateScore(currentGameId, 3, -1)">-</button>
                            <button class="score-button" onclick="updateScore(currentGameId, 3, 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="game-controls">
                    <button id="game-control" class="control-button" onclick="finishGame()">Spiel beenden</button>
                    <button id="delete-game" class="control-button delete" onclick="deleteGame(currentGameId)">Spiel l√∂schen</button>
                </div>
            </div>
        </div>

        <!-- Game History Screen -->
        <div class="screen" id="game-history-screen">
            <div class="screen-content">
                <h1 class="screen-title">Spielhistorie</h1>
                <div class="nav-buttons">
                    <button class="nav-button" onclick="showScreen('game-list-screen')">Zur√ºck zur Liste</button>
                </div>
            </div>
        </div>
    </div>

    <div class="loading-overlay">
        <div class="loading-indicator"></div>
    </div>

    <button id="fullscreen-toggle" class="fullscreen-toggle" onclick="toggleFullscreen()">
        <svg viewBox="0 0 24 24" width="24" height="24">
            <path fill="currentColor" d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
        </svg>
    </button>

    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close-button" onclick="closeModal()">&times;</span>
                <h2 id="modal-title">Spiel l√∂schen</h2>
            </div>
            <div class="modal-body">
                <p id="modal-message">M√∂chten Sie das Spiel zwischen Spieler 1 und Spieler 2 wirklich l√∂schen?</p>
            </div>
            <div class="modal-footer">
                <button class="modal-button cancel" onclick="closeModal()">Abbrechen</button>
                <button class="modal-button confirm" onclick="confirmDeleteGame(currentGameId)">L√∂schen</button>
            </div>
        </div>
    </div>

    <div id="validation-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close-button" onclick="closeValidationModal()">&times;</span>
                <h2 id="validation-modal-title">Fehler</h2>
            </div>
            <div class="modal-body">
                <p id="validation-modal-message"></p>
            </div>
            <div class="modal-footer">
                <button class="modal-button cancel" onclick="closeValidationModal()">OK</button>
            </div>
        </div>
    </div>

    <script>
        // Screen management
        const screens = {
            'new-game-screen': document.getElementById('new-game-screen'),
            'game-list-screen': document.getElementById('game-list-screen'),
            'game-detail-screen': document.getElementById('game-detail-screen'),
            'game-history-screen': document.getElementById('game-history-screen')
        };

        function showScreen(screenId) {
            const currentScreen = document.querySelector('.screen.active');
            const newScreen = document.getElementById(screenId);
            
            if (currentScreen) {
                currentScreen.classList.remove('active');
                currentScreen.classList.add('slide-out');
                
                setTimeout(() => {
                    currentScreen.classList.remove('slide-out');
                    newScreen.classList.add('active');
                    newScreen.classList.add('slide-in');
                    
                    setTimeout(() => {
                        newScreen.classList.remove('slide-in');
                    }, 300);
                }, 300);
            } else {
                newScreen.classList.add('active');
            }

            // Update name history when showing new game screen
            if (screenId === 'new-game-screen') {
                updateNameHistory();
            }
        }

        function showLoading() {
            document.querySelector('.loading-overlay').style.display = 'block';
            document.querySelector('.loading-indicator').style.display = 'block';
        }

        function hideLoading() {
            document.querySelector('.loading-overlay').style.display = 'none';
            document.querySelector('.loading-indicator').style.display = 'none';
        }

        // Game data management
        let games = [];
        let currentGameId = null;

        // Load games from localStorage on startup
        function loadGames() {
            const savedGames = localStorage.getItem('bscscore_games');
            if (savedGames) {
                games = JSON.parse(savedGames);
                renderGames();
            }
        }

        // Save games to localStorage
        function saveGames() {
            localStorage.setItem('bscscore_games', JSON.stringify(games));
        }

        // Initialize game list
        loadGames();

        // Track player name history
        let playerNameHistory = [];

        function updateNameHistory() {
            // Collect all player names from games
            const allNames = games.flatMap(game => [game.player1, game.player2, game.player3].filter(Boolean));
            
            // Create a map of names to their latest usage
            const nameLastUsed = {};
            games.forEach(game => {
                if (game.player1) nameLastUsed[game.player1] = Math.max(nameLastUsed[game.player1] || 0, new Date(game.updatedAt).getTime());
                if (game.player2) nameLastUsed[game.player2] = Math.max(nameLastUsed[game.player2] || 0, new Date(game.updatedAt).getTime());
                if (game.player3) nameLastUsed[game.player3] = Math.max(nameLastUsed[game.player3] || 0, new Date(game.updatedAt).getTime());
            });

            // Sort names by latest usage and remove duplicates
            playerNameHistory = [...new Set(Object.keys(nameLastUsed))]
                .sort((a, b) => nameLastUsed[b] - nameLastUsed[a]);

            // Update select dropdowns
            updateNameSelects();
        }

        function updateNameSelects() {
            const player1Select = document.getElementById('player1-select');
            const player2Select = document.getElementById('player2-select');
            const player3Select = document.getElementById('player3-select');

            // Clear existing options except the first one
            while (player1Select.options.length > 1) player1Select.remove(1);
            while (player2Select.options.length > 1) player2Select.remove(1);
            while (player3Select.options.length > 1) player3Select.remove(1);

            // Add player names to dropdowns
            playerNameHistory.forEach(name => {
                const option1 = new Option(name, name);
                const option2 = new Option(name, name);
                const option3 = new Option(name, name);
                player1Select.add(option1);
                player2Select.add(option2);
                player3Select.add(option3);
            });
        }

        function updatePlayerInput(playerId) {
            const select = document.getElementById(`${playerId}-select`);
            const input = document.getElementById(playerId);
            if (select.value) {
                input.value = select.value;
            }
        }

        function showValidationModal(message) {
            const modal = document.getElementById('validation-modal');
            const modalMessage = document.getElementById('validation-modal-message');
            modalMessage.textContent = message;
            modal.classList.add('show');
        }

        function closeValidationModal() {
            const modal = document.getElementById('validation-modal');
            modal.classList.remove('show');
        }

        function createNewGame() {
            const player1Name = document.getElementById('player1').value.trim();
            const player2Name = document.getElementById('player2').value.trim();
            const player3Name = document.getElementById('player3').value.trim();
            const gameType = document.getElementById('game-type').value;
            const raceTo = document.getElementById('race-to').value;
            
            if (!player1Name || !player2Name) {
                showValidationModal('Bitte Namen f√ºr beide Spieler eingeben');
                return;
            }

            const newGame = {
                id: Date.now(),
                player1: player1Name,
                player2: player2Name,
                player3: player3Name || null,
                score1: 0,
                score2: 0,
                score3: 0,
                gameType: gameType,
                raceTo: raceTo ? parseInt(raceTo) : null,
                status: 'active',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            games.push(newGame);
            saveGames();
            updateNameHistory();
            renderGames();
            showGameDetail(newGame.id);
        }

        function updateScore(gameId, player, change) {
            const game = games.find(g => g.id === gameId);
            if (!game || game.status === 'completed') return;

            if (player === 1) {
                game.score1 = Math.max(0, game.score1 + change);
            } else if (player === 2) {
                game.score2 = Math.max(0, game.score2 + change);
            } else if (player === 3) {
                game.score3 = Math.max(0, game.score3 + change);
            }

            game.updatedAt = new Date().toISOString();

            // Check for game completion
            if (game.raceTo && (game.score1 >= game.raceTo || game.score2 >= game.raceTo || game.score3 >= game.raceTo)) {
                game.status = 'completed';
            }

            saveGames();
            renderGames();
            
            // Update the game detail view scores directly if we're on it
            if (document.getElementById('game-detail-screen').classList.contains('active')) {
                document.getElementById('score1').textContent = game.score1;
                document.getElementById('score2').textContent = game.score2;
                document.getElementById('score3').textContent = game.score3;
                
                // Update control button if game is completed
                if (game.status === 'completed') {
                    const controlButton = document.getElementById('game-control');
                    controlButton.textContent = 'Zur√ºck zur Liste';
                    controlButton.onclick = () => showScreen('game-list-screen');
                    controlButton.classList.add('disabled');
                    
                    // Disable score buttons
                    const scoreButtons = document.querySelectorAll('.score-button');
                    scoreButtons.forEach(button => {
                        button.disabled = true;
                    });
                }
            }
        }

        function handleGameOver(gameId) {
            const game = games.find(g => g.id === gameId);
            if (!game) return;

            game.status = 'completed';
            game.updatedAt = new Date().toISOString();
            saveGames();
            renderGames();
            showScreen('game-list-screen');
        }

        function deleteGame(gameId) {
            const game = games.find(g => g.id === gameId);
            if (!game) return;

            currentGameId = gameId; // Set the currentGameId for the modal

            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modal-title');
            const modalMessage = document.getElementById('modal-message');

            modalTitle.textContent = 'Spiel l√∂schen';
            modalMessage.textContent = `M√∂chten Sie das Spiel zwischen ${game.player1} und ${game.player2} wirklich l√∂schen?`;
            modal.classList.add('show');
        }

        function closeModal() {
            const modal = document.getElementById('modal');
            modal.classList.remove('show');
            currentGameId = null; // Clear the currentGameId when closing the modal
        }

        function confirmDeleteGame(gameId) {
            if (!gameId) return; // Guard against missing gameId
            
            showLoading();
            setTimeout(() => {
                const gameIndex = games.findIndex(g => g.id === gameId);
                if (gameIndex !== -1) {
                    games.splice(gameIndex, 1);
                    saveGames();
                    renderGames();
                    if (currentGameId === gameId) {
                        showScreen('game-list-screen');
                    }
                }
                hideLoading();
                closeModal();
            }, 500);
        }

        function renderGames(filter = 'all') {
            const gamesContainer = document.getElementById('games-container');
            const filteredGames = games
                .filter(game => {
                    if (filter === 'active') return game.status === 'active';
                    if (filter === 'completed') return game.status === 'completed';
                    return true;
                })
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

            if (filteredGames.length === 0) {
                gamesContainer.innerHTML = '<div class="empty-state">Keine Spiele vorhanden</div>';
                return;
            }

            gamesContainer.innerHTML = filteredGames.map(game => {
                const playerNames = game.player3 
                    ? `${game.player1} vs ${game.player2} vs ${game.player3}`
                    : `${game.player1} vs ${game.player2}`;
                
                const scores = game.player3
                    ? `${game.score1} - ${game.score2} - ${game.score3}`
                    : `${game.score1} - ${game.score2}`;

                return `
                    <div class="game-item ${game.status === 'completed' ? 'completed' : 'active'}">
                        <div class="game-info" onclick="showGameDetail(${game.id})">
                            <div class="game-type">${game.gameType}${game.raceTo ? ` | ${game.raceTo}` : ''}</div>
                            <div class="player-names">${playerNames}</div>
                            <div class="game-scores">${scores}</div>
                        </div>
                        <button class="delete-button" onclick="deleteGame(${game.id})"></button>
                    </div>
                `;
            }).join('');
        }

        function showGameDetail(gameId) {
            const game = games.find(g => g.id === gameId);
            if (!game) return;

            currentGameId = gameId;
            
            // Update game title
            document.getElementById('game-title').textContent = 
                `${game.gameType}${game.raceTo ? ` | Race to ${game.raceTo}` : ''}`;
            
            // Update player names
            document.getElementById('player1-name').textContent = game.player1;
            document.getElementById('player2-name').textContent = game.player2;
            
            // Handle player 3
            const player3Score = document.getElementById('player3-score');
            if (game.player3) {
                document.getElementById('player3-name').textContent = game.player3;
                document.getElementById('score3').textContent = game.score3;
                player3Score.style.display = 'flex';
            } else {
                player3Score.style.display = 'none';
            }
            
            // Update scores
            document.getElementById('score1').textContent = game.score1;
            document.getElementById('score2').textContent = game.score2;

            // Add or remove franky class based on player names
            const player1Container = document.querySelector('.player-score:first-child');
            const player2Container = document.querySelector('.player-score:nth-child(2)');
            const player3Container = document.getElementById('player3-score');
            
            player1Container.classList.toggle('franky', game.player1 === 'Fr√§nky');
            player2Container.classList.toggle('franky', game.player2 === 'Fr√§nky');
            player3Container.classList.toggle('franky', game.player3 === 'Fr√§nky');

            // Update control button
            const controlButton = document.getElementById('game-control');
            if (game.status === 'completed') {
                controlButton.textContent = 'Zur√ºck zur Liste';
                controlButton.onclick = () => showScreen('game-list-screen');
                controlButton.classList.add('disabled');
            } else {
                controlButton.textContent = 'Spiel beenden';
                controlButton.onclick = () => finishGame();
                controlButton.classList.remove('disabled');
            }

            // Disable score buttons for completed games
            const scoreButtons = document.querySelectorAll('.score-button');
            scoreButtons.forEach(button => {
                button.disabled = game.status === 'completed';
            });

            showScreen('game-detail-screen');
        }

        function finishGame() {
            const game = games.find(g => g.id === currentGameId);
            if (!game) return;

            game.status = 'completed';
            game.updatedAt = new Date().toISOString();
            saveGames();
            showGameDetail(currentGameId);
        }

        // Initialize with game list screen
        showScreen('game-list-screen');

        function filterGames(filter) {
            // Update active state of filter buttons
            document.querySelectorAll('.filter-button').forEach(button => {
                button.classList.remove('active');
            });
            document.querySelector(`.filter-button[onclick="filterGames('${filter}')"]`).classList.add('active');
            
            // Render games with the selected filter
            renderGames(filter);
        }

        // Fullscreen functionality
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.log(`Error attempting to enable fullscreen: ${err.message}`);
                });
            } else {
                document.exitFullscreen();
            }
        }

        // Update fullscreen button icon when fullscreen changes
        document.addEventListener('fullscreenchange', () => {
            const button = document.getElementById('fullscreen-toggle');
            if (document.fullscreenElement) {
                button.innerHTML = `<svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>
                </svg>`;
            } else {
                button.innerHTML = `<svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
                </svg>`;
            }
        });
    </script>
</body>
</html>